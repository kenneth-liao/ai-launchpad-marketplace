# Gemini Image Generation API Reference

Curated reference for agent context. Covers the subset of the Gemini API used by Nano Banana.

## Models

| Model | ID | Best For |
|-------|----|----------|
| Pro | `gemini-3-pro-image-preview` | High quality, complex prompts, text in images, thinking mode |
| Flash | `gemini-2.5-flash-image` | Fast iteration, lower cost, simple prompts |

Both models share the same API surface. Pro supports thinking mode (reasoning about composition).

## Core API Call

```python
from google import genai
from google.genai import types

client = genai.Client(api_key="...")
response = client.models.generate_content(
    model="gemini-3-pro-image-preview",
    contents=["a cute robot"],          # text + optional image Parts
    config=types.GenerateContentConfig(
        response_modalities=["IMAGE", "TEXT"],
        image_config=types.ImageConfig(aspect_ratio="1:1", image_size="2K"),
    ),
)
```

## Config Parameters

**`GenerateContentConfig`:**
- `response_modalities` — Must include `"IMAGE"` for image output. Include `"TEXT"` to get optional text alongside.
- `image_config` — `ImageConfig(aspect_ratio=..., image_size=...)`
- `tools` — For search grounding: `[types.Tool(google_search=types.GoogleSearch())]`

**`ImageConfig`:**
- `aspect_ratio` — `"1:1"`, `"2:3"`, `"3:2"`, `"3:4"`, `"4:3"`, `"4:5"`, `"5:4"`, `"9:16"`, `"16:9"`, `"21:9"`
- `image_size` — `"1K"`, `"2K"`, `"4K"` (higher = more detail, slower)

## Multi-Image Input

Up to 14 reference images can be included in a single request. Each image is a `Part`:

```python
contents = [
    types.Part.from_bytes(data=img1_bytes, mime_type="image/png"),
    types.Part.from_bytes(data=img2_bytes, mime_type="image/jpeg"),
    "combine the style of the first image with the subject of the second",
]
```

Supported MIME types: `image/jpeg`, `image/png`, `image/webp`, `image/gif`.

## Response Parsing

```python
for part in response.candidates[0].content.parts:
    if part.inline_data and part.inline_data.mime_type.startswith("image/"):
        image_bytes = part.inline_data.data   # raw bytes, save directly
    elif hasattr(part, "thought") and part.thought:
        thinking_text = part.text             # Pro model reasoning (when available)
    elif part.text:
        text_response = part.text             # optional text alongside image
```

## Google Search Grounding

Improves factual accuracy for images involving real people, places, landmarks, and current events. Add to config:

```python
config = types.GenerateContentConfig(
    response_modalities=["IMAGE", "TEXT"],
    tools=[types.Tool(google_search=types.GoogleSearch())],
)
```

## SynthID Watermark

All images generated by Gemini contain an invisible SynthID digital watermark. This is automatic and cannot be disabled. The watermark survives common image transformations (resize, crop, compression).

## Rate Limits

- Free tier: ~10 RPM (requests per minute) for image generation
- Paid tier: Higher limits, varies by plan
- Rate limit errors return HTTP 429 / `RESOURCE_EXHAUSTED`
- Recommended: exponential backoff with 2s base delay

## Thinking Mode (Pro Only)

The Pro model may include `thought` parts in its response containing reasoning about image composition. These appear as parts where `part.thought == True`. The thinking text is in `part.text`.
